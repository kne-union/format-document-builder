"use strict";(self.webpackChunk_kne_components_format_document_builder=self.webpackChunk_kne_components_format_document_builder||[]).push([[830],{71830:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var r=n(94922),l=n.n(r),i=n(74946),o=n(9211),a=n.n(o),s=n(87832),c=n.n(s),u=n(54613),d=n.n(u),g=n(78678),p=n(67823),m=n(55199),f=n(15032),h=n(79111),b=n(54159),v=n.n(b);const{useContext:y,Provider:x}=(0,i.createContext)(),E=()=>{const{setRenderHtml:e,templateContent:t,initFormData:n,data:i,options:o,deleteFields:c}=y(),u=(0,s.useFormContext)(),m=Object.assign({},n,null==u?void 0:u.formData),f=(0,r.useRef)(null),h=(0,r.useMemo)((()=>d()(t)),[t])({data:a()(m,((e,t,r)=>{"function"===typeof i[r].render?e[r]=i[r].render(t):e[r]=t,(0,p.isEmpty)(e[r])&&(e[r]=n[r])}),{}),isDeletedField:e=>c.indexOf(e)>-1||null===m[e],options:o}),b=(0,g.A)(e);return(0,r.useEffect)((()=>{new MutationObserver((()=>{b(f.current.innerHTML)})).observe(f.current,{childList:!0,subtree:!0})}),[b]),l().createElement("div",{dangerouslySetInnerHTML:{__html:h},ref:f})};function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},w.apply(null,arguments)}function A(e,t){if(null==e)return{};var n={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.includes(r))continue;n[r]=e[r]}return n}const C=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing","word-break","white-space"],R={};let k;function S(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;k||(k=document.createElement("textarea"),k.setAttribute("tab-index","-1"),k.setAttribute("aria-hidden","true"),document.body.appendChild(k)),e.getAttribute("wrap")?k.setAttribute("wrap",e.getAttribute("wrap")):k.removeAttribute("wrap");const{paddingSize:l,borderSize:i,boxSizing:o,sizingStyle:a}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=e.getAttribute("id")||e.getAttribute("data-reactid")||e.getAttribute("name");if(t&&R[n])return R[n];const r=window.getComputedStyle(e),l=r.getPropertyValue("box-sizing")||r.getPropertyValue("-moz-box-sizing")||r.getPropertyValue("-webkit-box-sizing"),i=parseFloat(r.getPropertyValue("padding-bottom"))+parseFloat(r.getPropertyValue("padding-top")),o=parseFloat(r.getPropertyValue("border-bottom-width"))+parseFloat(r.getPropertyValue("border-top-width")),a={sizingStyle:C.map((e=>`${e}:${r.getPropertyValue(e)}`)).join(";"),paddingSize:i,borderSize:o,boxSizing:l};return t&&n&&(R[n]=a),a}(e,t);let s,c,u;k.setAttribute("style",`${a};\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important;\n  pointer-events: none !important;\n`),k.value=e.value||e.placeholder||"";let d=k.scrollHeight;if("border-box"===o?d+=i:"content-box"===o&&(d-=l),null!==n||null!==r){k.value=" ";const e=k.scrollHeight-l;null!==n&&(s=e*n,"border-box"===o&&(s=s+l+i),d=Math.max(s,d)),null!==r&&(c=e*r,"border-box"===o&&(c=c+l+i),u=d>c?"":"hidden",d=Math.min(c,d))}const g={height:d,overflowY:u,resize:"none"};return s&&(g.minHeight=s),c&&(g.maxHeight=c),g}const _=["onChange","triggerValidate","value","style","isActive","className"],z=e=>t=>{const{useField:n}=s.hooks,r=n(t);return l().createElement(e,Object.assign({},t,r))},O={Input:z((e=>{let{onChange:t,triggerValidate:n,value:i,isActive:o,style:a,className:s}=e;(0,r.useEffect)((()=>{o&&c.current.focus()}),[o]);const c=(0,r.useRef)();return l().createElement("input",{ref:c,style:Object.assign({},a,{border:"none",outline:"none",display:"block"}),className:v()(s,"react-form__field-component"),value:i||"",onChange:t,onBlur:n})})),TextArea:z((e=>{let{onChange:t,triggerValidate:n,value:i,style:o,isActive:a,className:s}=e;A(e,_);const[c,u]=(0,r.useState)({}),d=(0,r.useRef)();return(0,r.useEffect)((()=>{const e=()=>{a&&u(S(d.current))};e();const t=new MutationObserver(e);return t.observe(d.current,{subtree:!0,childList:!0}),()=>{t.disconnect()}}),[a]),(0,r.useEffect)((()=>{a&&d.current.focus()}),[a]),l().createElement("textarea",{ref:d,style:Object.assign({},o,{border:"none",outline:"none",display:"block",resize:"none"},c),className:v()(s,"react-form__field-component"),value:i||"",onChange:e=>{t(e.target.value)},onBlur:n})}))};var F="_Tn8Z5",P="_GouxO",j="_hM9TE",N="_Y-KpS",H="_Aab98",L="_srojx";const I=["isArray","type","typeProps","width","height","className","canDelete","canEdit"],V=()=>{const{data:e,getRootElement:t,setDeleteFields:n,getRenderElement:i,fields:o,deleteFields:c,rootElementId:u}=y(),d=Object.assign({},s.fields,O,o),{openApi:g}=(0,s.useFormContext)(),[p,b]=(0,r.useState)(null),x=(e=>{let{getRootElement:t,tags:n,getRenderElement:l,onSelected:i,onCancel:o}=e;const a=(0,r.useRef)(n);a.current=n;const s=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const e=s.current,n=n=>{let{clientX:r,clientY:s,target:c}=n;const u=l(),d=t();e.style["pointer-events"]="none",u.style["pointer-events"]="all";const g=document.elementFromPoint(r,s);u.style["pointer-events"]="none",e.style["pointer-events"]="all";const{currentTag:p,currentIndex:m,currentName:f}=(()=>{let e,t,n;for(let r of Object.keys(a.current)){const l=a.current[r],i=[].findIndex.call(d.querySelectorAll(`.${l}`),(e=>e.contains(g)));if(i>-1){e=l,t=i,n=r;break}}return{currentTag:e,currentIndex:t,currentName:n}})();if(!c.classList.contains("event-element"))return;if(!p)return void(o&&o());const h=d.querySelectorAll(`.${p}`)[m],b=h.getBoundingClientRect(),v=d.getBoundingClientRect(),y=window.getComputedStyle(g,null),x=window.getComputedStyle(h,null);"0px"!==y["font-size"]&&"0px"!==y["line-height"]?i&&i({location:{width:h.clientWidth,height:h.clientHeight,left:b.left-v.left,top:b.top-v.top},style:{fontSize:y["font-size"],fontWeight:y["font-weight"],textAlign:y["text-align"],lineHeight:y["line-height"],padding:x.padding},currentElement:g,currentTag:p,currentIndex:m,currentName:f}):o&&o()},r=e=>{!e.target&&t().contains(e.target)&&o&&o()};return e.addEventListener("click",n,!1),document.body.addEventListener("click",r,!0),window.addEventListener("resize",r),()=>{e.removeEventListener("click",n,!1),document.body.removeEventListener("click",r,!0),window.removeEventListener("resize",r)}}),[]),s})({getRootElement:t,getRenderElement:i,tags:a()(e,((e,t,n)=>{!1!==t.canEdit&&(e[n]=t.className)}),{}),onSelected:e=>{b(e)},onCancel:()=>{b(null)}});return l().createElement("div",{className:v()("event-element",j),ref:x},Object.keys(e).filter((e=>-1===c.indexOf(e))).map((r=>{const o=e[r],{isArray:a,type:c,typeProps:y,width:E,height:C,className:R,canDelete:k,canEdit:S=!0}=o,_=A(o,I),z=d[c];if(!z)return null;const O=e=>{const o=p&&p.currentName===r&&p.currentIndex===e&&S,s=(()=>{const n=i().querySelectorAll(`.${R}`)[e];if(!n)return null;const r=t();if(!r)return null;const{left:l,top:o}=null==r?void 0:r.getBoundingClientRect(),{left:a,top:s}=n.getBoundingClientRect();return{x:a-l+n.clientWidth,y:s-o+n.clientHeight/2,left:a,top:s,element:n,width:n.clientWidth,height:n.clientHeight}})();return l().createElement("div",{key:r+"_field_"+e},l().createElement("span",{className:v()(N,{[H]:o}),style:o?Object.assign({},p.style,{"--top":p.location.top+"px","--left":p.location.left+"px","--width":E||p.location.width+"px","--height":C||p.location.height+"px","--font-size":p.style.fontSize,"--font-weight":p.style.fontWeight,"--padding":p.style.padding,"--text-align":p.style.textAlign,"--line-height":p.style.lineHeight}):{},onClick:e=>{e.stopPropagation()}},o&&l().createElement("style",{children:`#${u} .${R}${a?`[data-index="${e}"]`:""}{visibility: hidden;}`}),l().createElement(z,w({},_,"function"===typeof y?Object.assign({},y({isActive:o,blur:()=>b(null),formApi:g})):Object.assign({},y),{name:r,isActive:o}))),!o&&!p&&s&&l().createElement(m.Space,{key:r+"opt",className:L,style:{"--left":s.x+"px","--top":s.y+"px"}},S&&l().createElement(m.Button,{type:"text",icon:l().createElement(f.A,null),onClick:e=>{var t;e.stopPropagation();const{left:n}=null==e||null==(t=e.target)?void 0:t.getBoundingClientRect(),{left:r}=s.element.getBoundingClientRect(),l=new PointerEvent("click",{bubbles:!0,cancelable:!0,clientX:e.clientX-(n-r),clientY:e.clientY});x.current.dispatchEvent(l)}}),k&&l().createElement(m.Button,{type:"text",icon:l().createElement(h.A,null),onClick:e=>{e.stopPropagation(),g.setField({name:r,value:null}),n((e=>{const t=e.slice(0);return t.push(r),t}))}})))},F=i();return F?a?l().createElement(s.GroupList,{name:r,defaultLength:F.querySelectorAll(`.${R}`).length},(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const{index:r}=(e=>{if("object"===typeof e[0])return e[0];const[t,{index:n,onRemove:r,length:l}]=e;return{id:t,index:n,onRemove:r,length:l}})(t);return O(r)})):O(0):null})))},$=(0,r.forwardRef)(((e,t)=>{const n=Object.assign({},{width:"769px"},e),{data:i,template:o,options:s,isPreview:u,width:d}=n,[g,p]=(0,r.useState)(""),[m,f]=(0,r.useState)([]),h=(0,r.useRef)(null),b=(0,r.useRef)(null),v=(0,r.useRef)(null),y=(0,r.useCallback)((()=>h.current),[]),w=(0,r.useCallback)((()=>b.current),[]),A=(e=>{let{data:t}=e;return(0,r.useMemo)((()=>a()(t,((e,t,n)=>{e[n]=t.default}),{})),[t])})({data:i});(0,r.useEffect)((()=>{const e=Object.assign({},A),t=[];Object.keys(e).forEach((n=>{null===e[n]&&t.push(n)})),t.length>0&&f((e=>{const n=e.slice(0);return t.forEach((e=>{-1===n.indexOf(e)&&n.push(e)})),n}))}),[A]),(0,r.useImperativeHandle)(t,(()=>({getRenderHtml:()=>g,deleteFields:m,getFormData:()=>{var e;return v.current?null==(e=v.current)?void 0:e.data:{}}})));const C=(0,r.useId)().replace(/:/g,"_");return l().createElement(x,{value:{renderHtml:g,setRenderHtml:p,rootElementId:C,templateContent:o,initFormData:A,data:i,options:s,deleteFields:m,setDeleteFields:f,getRootElement:y,getRenderElement:w}},u?l().createElement(E,null):l().createElement("div",{id:C,className:F,ref:h,style:{width:d}},l().createElement(c(),{ref:v,data:A},l().createElement("div",{className:P,ref:b},l().createElement(E,null)),l().createElement(V,null))))}))}}]);
//# sourceMappingURL=830.45af2a52.chunk.js.map